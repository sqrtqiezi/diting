# 微信协议 SAAS API 完整文档摘要

## 文档概述

本文档是微信协议 SAAS 平台的完整 API 接口文档摘要,提供了全面的微信自动化操作能力,包括账号管理、消息处理、联系人管理、群组管理、朋友圈操作、企业微信集成等功能。

### 基本信息

- **文档来源**: 内部微信协议文档 ([docs/微信协议.md](../微信协议.md))
- **API 总数**: 130 个接口
- **主要分类**: 13 个功能模块
- **请求方式**: 统一使用 POST 方法
- **数据格式**: application/json

---

## 重要说明

### 使用须知

1. **新设备登录注意事项**
   - 登录新设备前 3 天,不要做群发、发朋友圈、主加好友
   - 提示风控、环境异常等原因导致退出登录属于正常现象,重新登录即可
   - 登录久了设备就会转成常用设备,就不会退出登录

2. **调用方式**
   - 所有接口调用需根据指定文档操作
   - 参考文档: https://juhexbot.feishu.cn/docx/Vh6Qd2HwGoAdoaxvaovcmJGWnnh

3. **登录流程**
   - 参考文档: https://juhexbot.feishu.cn/docx/Os5IdN0tvonNYSxVKlmc8gTTnZb
   - 登录完成后需设置实例通知地址: `/client/set_notify_url`

4. **调用频率限制**
   - 当一分钟内调用次数超过 100 次,将限制调用接口
   - 限制后半小时解封
   - 请合理调用接口以保证账号安全

---

## 核心概念

### 实例 (Instance)

创建实例相当于创建了一个虚拟机器,一个实例只登录一个号,如需登录其他账号请重新创建实例,不用的实例可以删除。

### 通知类型枚举 (Notify Type)

```
Ready = 1001                    // 准备就绪
LoginQRCodeChange = 1002        // 登录二维码变化
UserLogin = 1003                // 用户登录
UserLogout = 1004               // 用户登出
InitFinish = 1005               // 初始化完成
HeartBeatError = 1006           // 心跳错误
SessionTimeout = 1007           // 会话超时
LoginFailed = 1008              // 登录失败
ContactSyncFinish = 1009        // 联系人同步完成

NewMsg = 1010                   // 新消息
BatchNewMsg = 1011              // 批量新消息

ContactInfoChange = 1039        // 联系人信息变化
FriendAdd = 1040                // 好友添加
FriendDel = 1041                // 好友删除

RoomAdd = 1042                  // 加入群聊
RoomQuit = 1043                 // 退出群聊
RoomDelMe = 1044                // 被移出群聊
RoomDisband = 1045              // 群聊解散
RoomMemberAdd = 1046            // 群成员添加
RoomMemberUpdate = 1047         // 群成员更新
RoomMemberDel = 1048            // 群成员删除

WxNotifyTypeCmdIdModContact = 1200      // 联系人修改
WxNotifyTypeCmdIdDelContact = 1201      // 联系人删除

WxNotifyTypeOpenImContactAdd = 1202             // 企业微信联系人添加
WxNotifyTypeOpenImContactDel = 1203             // 企业微信联系人删除
WxNotifyTypeOpenImRoomContactChange = 1204      // 企业微信群联系人变化

SyncMsgFailed = 2006            // 同步消息失败(需要调用 restore 接口)
```

### 消息类型枚举 (Message Type)

```
WX_MSG_TEXT = 1                 // 0x1 文本消息
WX_MSG_PICTURE = 3              // 0x3 图片消息
WX_MSG_VOICE = 34               // 0x22 语音消息
WX_MSG_FRIEND = 37              // 0x25 加好友请求
WX_MSG_CARD = 42                // 0x2A 名片消息
WX_MSG_VIDEO = 43               // 0x2B 视频消息
WX_MSG_EMOJI = 47               // 0x2F 表情消息
WX_MSG_CHANGE_TALKER = 51       // 手机上正在聊天的人
WX_MSG_LOCATION = 48            // 0x30 位置消息
WX_MSG_APP = 49                 // 0x31 应用类型(文件-6、链接-5、小程序-33、51-视频号、57-引用)
WX_MSG_SYSTEM = 10000           // 0x2710 系统消息
WX_MSG_REVOKE = 10002           // 0x2712 撤回消息
```

### 联系人类型枚举

```
Stranger = 0                    // 陌生人
System = 1                      // 系统
Friend = 2                      // 好友
Mp = 3                          // 公众号
ChatRoom = 4                    // 群聊
```

---

## API 接口分类详解

### 1. 客户端管理 (Client) - 8个接口

**功能**: 管理微信实例的生命周期和配置

| 接口名称 | 端点 | 说明 |
|---------|------|------|
| 恢复实例 | `/client/restore_client` | 恢复已停止的实例 |
| 停止实例 | `/client/stop_client` | 停止运行中的实例 |
| 设置实例通知地址 | `/client/set_notify_url` | 配置接收通知的回调地址 |
| 设置实例桥接 | `/client/set_bridge` | 设置实例桥接标识 |
| 设置实例代理 | `/client/set_proxy` | 配置网络代理 |
| 升级实例 | `/client/update_client` | 升级实例版本 |
| 获取实例状态 | `/client/get_client_status` | 查询实例当前状态 |
| 获取实例版本 | `/client/get_client_version` | 获取实例版本信息 |

**使用场景**:
- 实例创建后的初始化配置
- 实例状态监控和管理
- 实例升级和维护

---

### 2. 登录管理 (Login) - 4个接口

**功能**: 处理微信账号的登录流程

| 接口名称 | 端点 | 说明 |
|---------|------|------|
| 获取登录二维码 | `/login/get_login_qrcode` | 生成登录二维码 |
| 检查登录二维码状态 | `/login/check_login_qrcode` | 轮询二维码扫描状态 |
| 推送手机确认登录通知 | `/login/push_login_url` | 推送登录确认通知 |
| 验证登录 | `/login/verify_login_url` | 完成登录验证 |

**登录流程**:
1. 调用获取登录二维码接口
2. 展示二维码供用户扫描
3. 轮询检查二维码状态
4. 用户确认后完成登录验证
5. 设置通知地址接收后续消息

---

### 3. 用户管理 (User) - 3个接口

**功能**: 管理当前登录账号的信息

| 接口名称 | 端点 | 说明 |
|---------|------|------|
| 获取登录账号信息 | `/user/get_profile` | 获取当前登录用户详细信息 |
| 获取个人二维码 | `/user/get_qrcode` | 获取个人微信二维码 |
| 退出登录 | `/user/logout` | 退出当前登录 |

---

### 4. 联系人管理 (Contact) - 9个接口

**功能**: 管理微信好友和联系人

| 接口名称 | 端点 | 主要功能 |
|---------|------|----------|
| 同步联系人 | `/contact/init_contact` | 同步所有联系人信息 |
| 置顶聊天 | `/contact/modify_contact_top_flag` | 将聊天置顶 |
| 获取联系人详细 | `/contact/get_contact` | 获取单个联系人详细信息 |
| 批量获取联系人简要信息 | `/contact/batch_get_contact_brief_info` | 批量获取联系人基本信息 |
| 通过手机号/微信号/QQ搜索 | `/contact/search_contact` | 搜索微信用户 |
| 添加微信用户 | `/contact/add_friend` | 添加好友 |
| 检查好友状态/同意好友申请 | `/contact/verify_friend` | 处理好友请求 |
| 修改好友备注 | `/contact/modify_remark` | 修改好友备注名 |
| 删除好友 | `/contact/del_friend` | 删除好友关系 |

**典型使用场景**:
- 自动添加好友
- 好友信息管理
- 好友关系维护

---

### 5. 群组管理 (Room) - 21个接口

**功能**: 完整的微信群管理能力

#### 群信息管理
- 获取群信息
- 获取群成员详细
- 获取群二维码

#### 群操作
- 创建群组
- 添加群成员(低于40人)
- 邀请群成员
- 移除群成员
- 退出群
- 转让群主

#### 群设置
- 修改群名称
- 设置群公告
- 修改群显示昵称
- 是否显示群成员昵称
- 是否保存到通讯录
- 是否折叠群
- 消息免打扰
- 置顶聊天

#### 群消息管理
- 置顶消息
- 取消置顶消息
- 获取置顶消息列表

#### 社交功能
- 添加群成员为好友

**使用场景**:
- 自动化群管理
- 批量群操作
- 群成员管理

---

### 6. 消息管理 (Msg) - 23个接口

**功能**: 发送和处理各类微信消息

#### 文本消息
- 发送文本消息
- 发送群@消息
- 发送引用消息

#### 多媒体消息
- 发送图片
- 发送视频
- 发送文件
- 发送语音

#### 特殊消息
- 发送表情
- 发送表情url
- 发送表情md5
- 发送位置
- 发送拍一拍

#### 卡片消息
- 发送分享名片
- 发送链接卡片
- 发送链接卡片CDN
- 发送APPMSG
- 发送小程序
- 发送视频号

#### 消息管理
- 撤回消息
- 设置消息已读

#### 语音处理
- 生成语音转文字ID
- 检查语音转文字
- 上传待转文字的语音
- 获取语音转文字结果

**使用场景**:
- 自动回复
- 消息群发
- 多媒体内容分享
- 语音识别

---

### 7. 云存储 (Cloud) - 19个接口

**功能**: 处理微信媒体文件的上传和下载

#### 上传功能
- 上传图片、视频或文件
- 上传朋友圈类型图片
- 上传朋友圈类型视频

#### 下载功能
- 下载图片、视频或文件
- 下载收藏类型的文件或视频
- 下载企微媒体文件
- 下载语音
- 下载微信加密视频
- 下载微信加密图片
- 下载微信加密表情

#### 系统管理
- 更新CDNClient DNS信息

**使用场景**:
- 媒体文件中转
- 内容备份
- 文件转发

---

### 8. 标签管理 (Label) - 7个接口

**功能**: 管理联系人标签

| 接口名称 | 功能说明 |
|---------|----------|
| 获取所有标签 | 获取标签列表 |
| 新建标签 | 创建新标签 |
| 修改标签 | 修改标签信息 |
| 删除标签 | 删除指定标签 |
| 给联系人打标签 | 为联系人添加标签 |
| 根据标签获取联系人 | 按标签筛选联系人 |
| 获取标签下联系人数量 | 统计标签下的联系人 |

**使用场景**:
- 客户分类管理
- 批量操作筛选
- 用户画像建立

---

### 9. 企业微信 (OpenIM) - 12个接口

**功能**: 企业微信相关操作

#### 信息获取
- 获取企微好友列表(本地存储)
- 获取企微群列表(本地存储)
- 获取企微群群成员(本地存储)
- 获取企微群信息
- 获取企微群成员信息
- 获取企微联系人详细信息
- 获取企微联系人企业信息

#### 联系人管理
- 通过企微二维码查询联系人
- 添加企微联系人
- 发送企微联系人验证请求
- 删除企微联系人
- 检查企微联系人状态接口

#### 设置管理
- 修改企微联系人免打扰状态
- 修改企微联系人置顶状态

**使用场景**:
- 企业微信集成
- B2B 客户管理
- 企业通讯录同步

---

### 10. 朋友圈 (Sns) - 8个接口

**功能**: 朋友圈内容管理

#### 浏览功能
- 获取朋友圈动态
- 获取好友朋友圈动态
- 获取朋友圈动态详细信息

#### 发布功能
- 发布朋友圈

#### 互动功能
- 评论
- 删除评论
- 点赞/取消点赞

#### 管理功能
- 删除朋友圈

**使用场景**:
- 自动化营销
- 朋友圈监控
- 内容分发

---

### 11. 应用集成 (App) - 12个接口

**功能**: 小程序和第三方应用集成

#### URL 处理
- 取真实URL (2个接口)

#### 小程序
- 小程序授权登录
- 小程序安全通讯
- 小程序安全通讯VIP
- 生成小程序短链接
- 解析小程序短链接 (2个接口)

#### OAuth 授权
- OAuth登录授权
- OAuth登录授权确认
- 第三方网站扫码登录授权
- 第三方网站扫码登录授权确认

**使用场景**:
- 小程序自动化
- 第三方登录
- 链接转换

---

### 12. 其他功能 (Other) - 2个接口

**功能**: 辅助功能

- 语音转文字
- 语音转文字分片

---

### 13. CDN管理 (CDN) - 2个接口

**功能**: CDN文件管理

| 接口名称 | 端点 | 说明 |
|---------|------|------|
| 获取CDN文件 | `/cdn/get_cdn_file` | 获取CDN存储的文件 |
| 获取CDN信息 | `/cdn/get_cdn_info` | 获取CDN配置信息 |

**使用场景**:
- 文件下载和访问
- CDN配置查询

---

## 典型应用场景

### 1. 客服机器人
- 自动回复文本消息
- 处理图片/文件消息
- 联系人管理
- 消息已读状态设置

### 2. 社群运营
- 群成员管理
- 群消息发送
- 群公告设置
- 新成员欢迎

### 3. 营销自动化
- 朋友圈发布
- 好友批量添加
- 标签分组管理
- 消息群发

### 4. 企业集成
- 企业微信对接
- 客户信息同步
- 消息通知推送
- 文件传输

### 5. 数据采集
- 联系人信息同步
- 朋友圈内容抓取
- 聊天记录备份
- 群成员分析

---

## 技术架构建议

### 1. 实例管理
```
- 为每个微信账号创建独立实例
- 监控实例状态,异常时自动恢复
- 合理分配实例资源
```

### 2. 消息处理
```
- 配置通知回调地址接收实时消息
- 实现消息队列处理高并发
- 做好消息去重和幂等性处理
```

### 3. 频率控制
```
- 控制API调用频率(<100次/分钟)
- 实现请求限流和排队机制
- 添加重试和错误处理逻辑
```

### 4. 异常处理
```
- 监听各类通知事件
- 处理登录异常和会话超时
- 实现自动重连机制
```

---

## 开发最佳实践

### 1. 安全性
- 保护好实例的 guid 标识
- 使用 HTTPS 配置通知地址
- 定期更新实例代理配置
- 避免频繁操作触发风控

### 2. 稳定性
- 新设备登录后观察3天再进行批量操作
- 模拟真实用户行为,避免机器人特征
- 遇到风控提示及时停止操作
- 保持合理的消息发送间隔

### 3. 性能优化
- 使用批量接口减少请求次数
- 合理使用本地缓存存储
- 异步处理耗时操作
- 实现请求并发控制

### 4. 监控运维
- 监控实例状态和心跳
- 记录API调用日志
- 统计成功率和错误率
- 设置告警通知

---

## 接口调用示例

### 基本请求格式

```bash
curl --location --request POST 'https://api.example.com/client/get_client_version' \
--header 'Content-Type: application/json' \
--data-raw '{
    "guid": "your-instance-guid"
}'
```

### 响应格式

#### 成功响应 (200)
```json
{
    "code": 0,
    "message": "success",
    "data": {
        // 具体数据
    }
}
```

#### 验证错误 (422)
```json
{
    "code": 422,
    "message": "Validation Error",
    "errors": [
        // 错误详情
    ]
}
```

---

## 总结

微信协议 SAAS API 提供了完整的微信自动化能力,涵盖了:

✅ **全面的功能覆盖**: 从登录、消息、联系人到朋友圈、企业微信,覆盖微信主要功能
✅ **灵活的实例管理**: 支持多实例、代理配置、状态监控
✅ **丰富的消息类型**: 支持文本、图片、视频、文件、小程序等所有消息类型
✅ **强大的群管理**: 提供完整的群创建、管理、成员操作能力
✅ **企业级特性**: 支持企业微信、私有化部署、CDN 加速

**总计 130 个 API 接口**,为微信自动化、社群运营、客服机器人、营销工具等应用场景提供了坚实的技术基础。

---

## 附录

### 相关文档链接
- 主文档: https://weixins.apifox.cn
- 调用方式说明: https://juhexbot.feishu.cn/docx/Vh6Qd2HwGoAdoaxvaovcmJGWnnh
- 登录流程参考: https://juhexbot.feishu.cn/docx/Os5IdN0tvonNYSxVKlmc8gTTnZb

### 联系方式
- 微信: hansonskr

---

**文档生成时间**: 2025-11-01
**文档版本**: v1.0
